<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æ©Ÿæ—¥æœŸé¸æ“‡å™¨æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        /* æ–¹æ¡ˆ1ï¼šéš±è—ä½†ä¿æŒå¯è§¸ç™¼ */
        .date-container-v1 {
            position: relative;
        }

        .date-display-v1 {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
            font-family: inherit;
            background: white;
            cursor: pointer;
            text-align: left;
            user-select: none;
            -webkit-user-select: none;
        }

        .date-display-v1:focus {
            outline: none;
            border-color: #2d4874;
            box-shadow: 0 0 0 3px rgba(45, 72, 116, 0.1);
        }

        .hidden-date-input-v1 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }

        /* æ–¹æ¡ˆ2ï¼šé€æ˜è¦†è“‹ */
        .date-container-v2 {
            position: relative;
        }

        .date-display-v2 {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            background: white;
            text-align: left;
            pointer-events: none;
        }

        .transparent-date-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            border: none;
            background: transparent;
            font-size: 16px;
            cursor: pointer;
        }

        /* æ–¹æ¡ˆ3ï¼šå½è£çš„çœŸå¯¦è¼¸å…¥ */
        .styled-date-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            background: white;
            cursor: pointer;
            
            /* éš±è—é è¨­æ—¥æœŸé¸æ“‡å™¨åœ–æ¨™ */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .styled-date-input::-webkit-calendar-picker-indicator {
            opacity: 0;
            position: absolute;
            right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .styled-date-input:focus {
            outline: none;
            border-color: #2d4874;
            box-shadow: 0 0 0 3px rgba(45, 72, 116, 0.1);
        }

        /* è‡ªè¨‚æ—¥æœŸåœ–æ¨™ */
        .date-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #666;
        }

        .test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
        }

        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }

        .method-title {
            font-size: 18px;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #2d4874;
        }

        .method-description {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>æ‰‹æ©Ÿç«¯æ—¥æœŸé¸æ“‡å™¨ä¿®å¾©æ¸¬è©¦</h1>
    <p>è«‹åœ¨ä¸åŒè¨­å‚™ä¸Šæ¸¬è©¦ä»¥ä¸‹ä¸‰ç¨®æ–¹æ¡ˆï¼š</p>

    <div class="method-title">æ–¹æ¡ˆ1ï¼šæ”¹é€²çš„éš±è—è¼¸å…¥è§¸ç™¼</div>
    <div class="method-description">
        ä½¿ç”¨å¤šé‡è§¸ç™¼æ©Ÿåˆ¶ï¼ŒåŒ…å«è§¸æ§äº‹ä»¶å’Œæ”¹é€²çš„å…ƒç´ å®šä½
    </div>
    <div class="form-group">
        <label for="date1">æ—¥æœŸé¸æ“‡ (æ–¹æ¡ˆ1)</label>
        <div class="date-container-v1">
            <div class="date-display-v1" id="dateDisplay1" onclick="openDatePickerV1()" ontouchstart="openDatePickerV1()">
                è«‹é¸æ“‡æ—¥æœŸ
            </div>
            <input type="date" id="date1" class="hidden-date-input-v1" onchange="updateDateDisplayV1()">
        </div>
    </div>

    <div class="method-title">æ–¹æ¡ˆ2ï¼šé€æ˜è¼¸å…¥è¦†è“‹</div>
    <div class="method-description">
        ä½¿ç”¨é€æ˜çš„çœŸå¯¦æ—¥æœŸè¼¸å…¥è¦†è“‹åœ¨é¡¯ç¤ºå…ƒç´ ä¸Š
    </div>
    <div class="form-group">
        <label for="date2">æ—¥æœŸé¸æ“‡ (æ–¹æ¡ˆ2)</label>
        <div class="date-container-v2">
            <div class="date-display-v2" id="dateDisplay2">è«‹é¸æ“‡æ—¥æœŸ</div>
            <input type="date" id="date2" class="transparent-date-input" onchange="updateDateDisplayV2()">
        </div>
    </div>

    <div class="method-title">æ–¹æ¡ˆ3ï¼šè‡ªè¨‚æ¨£å¼çš„çœŸå¯¦è¼¸å…¥</div>
    <div class="method-description">
        ç›´æ¥ä½¿ç”¨æ—¥æœŸè¼¸å…¥ä½†å®Œå…¨è‡ªè¨‚å¤–è§€
    </div>
    <div class="form-group">
        <label for="date3">æ—¥æœŸé¸æ“‡ (æ–¹æ¡ˆ3)</label>
        <div style="position: relative;">
            <input type="date" id="date3" class="styled-date-input" onchange="updateDateDisplayV3()" placeholder="è«‹é¸æ“‡æ—¥æœŸ">
            <span class="date-icon">ğŸ“…</span>
        </div>
    </div>

    <div class="test-result info" id="testResult">
        <strong>æ¸¬è©¦çµæœï¼š</strong><br>
        è¨­å‚™è³‡è¨Šå°‡åœ¨é€™è£¡é¡¯ç¤º...
    </div>

    <script>
        // è¨­å‚™æª¢æ¸¬
        function detectDevice() {
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isAndroid = /Android/.test(userAgent);
            const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
            
            return {
                isMobile,
                isIOS,
                isAndroid,
                isSafari,
                userAgent: userAgent.substring(0, 100) + '...'
            };
        }

        // é¡¯ç¤ºè¨­å‚™è³‡è¨Š
        function displayDeviceInfo() {
            const device = detectDevice();
            const testResult = document.getElementById('testResult');
            
            testResult.innerHTML = `
                <strong>è¨­å‚™æª¢æ¸¬çµæœï¼š</strong><br>
                è¡Œå‹•è£ç½®: ${device.isMobile ? 'æ˜¯' : 'å¦'}<br>
                iOS: ${device.isIOS ? 'æ˜¯' : 'å¦'}<br>
                Android: ${device.isAndroid ? 'æ˜¯' : 'å¦'}<br>
                Safari: ${device.isSafari ? 'æ˜¯' : 'å¦'}<br>
                User Agent: ${device.userAgent}<br>
                <br>
                <strong>æ”¯æ´çš„ APIï¼š</strong><br>
                showPicker(): ${HTMLInputElement.prototype.showPicker ? 'æ”¯æ´' : 'ä¸æ”¯æ´'}<br>
                Touch Events: ${'ontouchstart' in window ? 'æ”¯æ´' : 'ä¸æ”¯æ´'}
            `;
        }

        // æ–¹æ¡ˆ1ï¼šæ”¹é€²çš„éš±è—è¼¸å…¥è§¸ç™¼
        function openDatePickerV1() {
            const dateInput = document.getElementById('date1');
            
            // æš«æ™‚è®“å…ƒç´ å¯è¦‹å’Œå¯äº¤äº’
            dateInput.style.position = 'absolute';
            dateInput.style.opacity = '0.01'; // å¹¾ä¹é€æ˜ä½†ä¸å®Œå…¨éš±è—
            dateInput.style.pointerEvents = 'auto';
            dateInput.style.zIndex = '9999';
            dateInput.style.left = '0';
            dateInput.style.top = '0';
            dateInput.style.width = '100%';
            dateInput.style.height = '100%';
            
            // å˜—è©¦å¤šç¨®è§¸ç™¼æ–¹å¼
            setTimeout(() => {
                try {
                    // æ–¹æ³•1: showPicker API (æœ€æ–°)
                    if (dateInput.showPicker && typeof dateInput.showPicker === 'function') {
                        console.log('å˜—è©¦ showPicker()');
                        dateInput.showPicker();
                    }
                    // æ–¹æ³•2: focus + click çµ„åˆ
                    else {
                        console.log('å˜—è©¦ focus + click');
                        dateInput.focus();
                        dateInput.click();
                        
                        // æ–¹æ³•3: è§¸ç™¼ touch äº‹ä»¶ (è¡Œå‹•è£ç½®)
                        if ('ontouchstart' in window) {
                            const touchEvent = new TouchEvent('touchstart', {
                                bubbles: true,
                                cancelable: true
                            });
                            dateInput.dispatchEvent(touchEvent);
                        }
                    }
                } catch (error) {
                    console.error('æ—¥æœŸé¸æ“‡å™¨è§¸ç™¼å¤±æ•—:', error);
                    // æœ€å¾Œæ‰‹æ®µï¼šç›´æ¥é»æ“Š
                    dateInput.click();
                }
                
                // æ¢å¾©éš±è—ç‹€æ…‹
                setTimeout(() => {
                    dateInput.style.position = '';
                    dateInput.style.opacity = '';
                    dateInput.style.pointerEvents = '';
                    dateInput.style.zIndex = '';
                }, 100);
            }, 10);
        }

        function updateDateDisplayV1() {
            const dateInput = document.getElementById('date1');
            const dateDisplay = document.getElementById('dateDisplay1');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                dateDisplay.textContent = `${month}æœˆ${day}æ—¥`;
                dateDisplay.style.color = '#000';
            } else {
                dateDisplay.textContent = 'è«‹é¸æ“‡æ—¥æœŸ';
                dateDisplay.style.color = '#999';
            }
            
            console.log('æ–¹æ¡ˆ1 - æ—¥æœŸå·²é¸æ“‡:', dateInput.value);
        }

        // æ–¹æ¡ˆ2ï¼šé€æ˜è¼¸å…¥è¦†è“‹
        function updateDateDisplayV2() {
            const dateInput = document.getElementById('date2');
            const dateDisplay = document.getElementById('dateDisplay2');
            
            if (dateInput.value) {
                const date = new Date(dateInput.value);
                const month = date.getMonth() + 1;
                const day = date.getDate();
                dateDisplay.textContent = `${month}æœˆ${day}æ—¥`;
                dateDisplay.style.color = '#000';
            } else {
                dateDisplay.textContent = 'è«‹é¸æ“‡æ—¥æœŸ';
                dateDisplay.style.color = '#999';
            }
            
            console.log('æ–¹æ¡ˆ2 - æ—¥æœŸå·²é¸æ“‡:', dateInput.value);
        }

        // æ–¹æ¡ˆ3ï¼šè‡ªè¨‚æ¨£å¼çš„çœŸå¯¦è¼¸å…¥
        function updateDateDisplayV3() {
            const dateInput = document.getElementById('date3');
            console.log('æ–¹æ¡ˆ3 - æ—¥æœŸå·²é¸æ“‡:', dateInput.value);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            displayDeviceInfo();
            
            // æ–¹æ¡ˆ1 äº‹ä»¶ç›£è½
            const dateDisplay1 = document.getElementById('dateDisplay1');
            dateDisplay1.addEventListener('touchstart', function(e) {
                e.preventDefault(); // é˜²æ­¢é›™é‡è§¸ç™¼
                openDatePickerV1();
            }, { passive: false });
            
            // é˜»æ­¢æ–¹æ¡ˆ2çš„é»æ“Šäº‹ä»¶å†’æ³¡
            document.getElementById('date2').addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            console.log('æ‰€æœ‰äº‹ä»¶ç›£è½å™¨å·²è¨­å®šå®Œæˆ');
        });

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨åŸŸéŒ¯èª¤:', e.error);
        });
    </script>
</body>
</html>
